branches:
  only:
    - master
os:
  - linux
  - osx
dist: bionic
language: rust
install:
  - curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash
  - nvm install 14
  - nvm use 14
  - node --version
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH="$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH"
  - yarn --version
script:
  - cargo --version # explictitly overwrite to avoid travis run cargo test on root dir
jobs:
  # allow_failures:
  #   - rust: nightly
  fast_finish: true
  include:
    # name is helpful because it displays on github ui
    - name: verify eth headers
      script: ci/test_verify_eth_headers.sh
    - name: verify eth proofs
      script: ci/test_verify_eth_proofs.sh
    - name: eth-client tests
      script:
      - cd libs-rs
      - eth-client/test.sh
    - name: eth-prover tests
      script:
      - cd libs-rs
      - eth-prover/test.sh
    - name: build all rust contracts
      script:
      - cd libs-rs
      - ./build_all.sh
    - name: enviroment lint
      script:
      - cd environment
      - yarn
      - yarn run lint
    - name: build all solidity contracts
    script:
      - cd libs-sol
      - ./build_all.sh
    